import{_ as t,c as s,o as a,aN as i}from"./chunks/framework.ClnKacJt.js";const g=JSON.parse('{"title":"Leverage GitHub Actions to automatically build binary-to-release go projects","description":"","frontmatter":{"title":"Leverage GitHub Actions to automatically build binary-to-release go projects","date":"2022-12-12T13:10:22.000Z"},"headers":[],"relativePath":"en/02-github-actions/12-Automatically-build-binary-to-release-of-go-project.md","filePath":"en/02-github-actions/12-Automatically-build-binary-to-release-of-go-project.md","lastUpdated":1768579861000}'),n={name:"en/02-github-actions/12-Automatically-build-binary-to-release-of-go-project.md"};function l(r,e,o,d,h,p){return a(),s("div",null,[...e[0]||(e[0]=[i(`<h1 id="leverage-github-actions-to-automatically-build-binary-to-release-go-projects" tabindex="-1">Leverage GitHub Actions to automatically build binary-to-release go projects <a class="header-anchor" href="#leverage-github-actions-to-automatically-build-binary-to-release-go-projects" aria-label="Permalink to &quot;Leverage GitHub Actions to automatically build binary-to-release go projects&quot;">​</a></h1><h2 id="preface" tabindex="-1">Preface <a class="header-anchor" href="#preface" aria-label="Permalink to &quot;Preface&quot;">​</a></h2><p>The recent ChatGPT fire, along with it, is a large number of tools written on ChatGPT, my project <a href="https://github.com/eryajf/chatgpt-dingtalk" target="_blank" rel="noreferrer">chatgpt-dingtalk</a> It is also one of these projects that aims to provide the ability to interact with ChatGPT in DingTalk group chats.</p><p>This is a utility project that already provides the ability to deploy docker with one click. But there are also people who just want to experience through binary direct deployment, multi-platform compatible binary construction, has long been supported by mature Actions, this article will introduce an implementation scheme.</p><h2 id="disposition" tabindex="-1">Disposition <a class="header-anchor" href="#disposition" aria-label="Permalink to &quot;Disposition&quot;">​</a></h2><p>Used Actions：<a href="https://github.com/wangyoucao577/go-release-action" target="_blank" rel="noreferrer">go-release-action</a></p><p>Using the configuration is actually very simple, basically after reading the official introduction document, you can get started.</p><p>Let&#39;s add the following to the workflows directory:</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$ cat go-binary-release.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build-go-binary</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  release</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">created</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Indicates that it is triggered when a new Release is created</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build-go-binary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    strategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      matrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        goos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">linux</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">windows</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">darwin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#S ystems that need to be packaged</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        goarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">amd64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arm64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># A packaged schema is required</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        exclude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Exclude certain platforms and architectures</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">goarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arm64</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            goos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">windows</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">wangyoucao577/go-release-action@v1.30</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          github_token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.GITHUB_TOKEN }}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # A default variable that allows adding files to Release</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          goos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ matrix.goos }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          goarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ matrix.goarch }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          goversion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.18</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # You can specify the version of Golang to use for compilation</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          binary_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;chatgpt-dingtalk&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # You can specify the name of the binary</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          extra_files</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">README.md config.dev.json</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Extra files that need to be included</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>After configuration, we can go to the release page, click <code>Draft a new release</code> After creating a release, this Actions will automatically run and play the binary under different environments and different architectures.</p><p>The effect is as follows:</p><p><img src="http://t.eryajf.net/imgs/2022/12/1d8e1511fa8befa5.png" alt="" loading="lazy"></p><h2 id="parameter-description" tabindex="-1">Parameter description <a class="header-anchor" href="#parameter-description" aria-label="Permalink to &quot;Parameter description&quot;">​</a></h2><p>As mentioned above, the parameters used in the YAML file have basically been commented, and here is a comment description of all the parameters currently provided by the official:</p><div><table tabindex="0"><thead><tr><th style="text-align:center;">The parameter name</th><th style="text-align:center;"><strong>Required</strong></th><th style="text-align:center;">illustrate</th></tr></thead><tbody><tr><td style="text-align:center;">github_token</td><td style="text-align:center;"><strong>Be</strong></td><td style="text-align:center;">Your <code>GITHUB_TOKEN</code> is used to upload the version to Github Release.</td></tr><tr><td style="text-align:center;">goos</td><td style="text-align:center;"><strong>Be</strong></td><td style="text-align:center;"><code>GOOS</code> is the operating system on which the program runs: darwin, windows, linux, etc.</td></tr><tr><td style="text-align:center;">goarch</td><td style="text-align:center;"><strong>Be</strong></td><td style="text-align:center;"><code>GOARCH</code> is the architecture on which the program runs: 386, amd64, arm, arm64, s390x, loong64, etc.</td></tr><tr><td style="text-align:center;">goamd64</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;"><code>GOAMD64</code> is a program running at the amd64 microarchitecture level, available as of 1.18. It can only be used when GOARCH is amd64: v1, v2, v3, v4.</td></tr><tr><td style="text-align:center;">goversion</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">Go compile the environment version <code>latest</code> (<a href="https://go.dev/VERSION?m=text" target="_blank" rel="noreferrer">check it here</a>) is the default and customizable options are： <code>1.13</code>, <code>1.14</code>, <code>1.15</code>, <code>1.16</code>, <code>1.17</code>, <code>1.18</code>, <code>1.19</code>.</td></tr><tr><td style="text-align:center;">project_path</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">Where to run the <code>go build</code> command。</td></tr><tr><td style="text-align:center;">binary_name</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">If you don&#39;t want to use the repository name as the binary name, specify another binary name. If not, use the base name of the repository</td></tr><tr><td style="text-align:center;">pre_command</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">Extra commands that will be executed before the build. If you don&#39;t use the Go module, you might want to use it to solve dependency problems.</td></tr><tr><td style="text-align:center;">build_command</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">The actual command to build the binary, usually with <code>go build</code>. You may want to use a different command wrapper, e.g., <a href="https://github.com/gobuffalo/packr/tree/master/v2" target="_blank" rel="noreferrer">packr2</a>, example <code>build_command: &#39;packr2 build&#39;</code>. Remember to set the <code>packr2</code> command with <code>pre_command</code>. It also supports <code>make</code> (<code>Makefile</code>) build scheme, example <code>build_command: make</code>. In this case both <code>build_flags</code> and <code>ldflags</code> will be ignored as they should be written in your <code>Makefile</code>. Also, make sure that the generated binaries are placed in the path where Make runs, i.e., <code>project_path</code>.</td></tr><tr><td style="text-align:center;">executable_compression</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">Compress executable binaries with some third-party tools. It accepts as input a compression command with a no parameter, such as UPX or UPX-V. Only UPX is currently supported.</td></tr><tr><td style="text-align:center;">build_flags</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">Additional parameters passed to the <code>go build</code> command.</td></tr><tr><td style="text-align:center;">ldflags</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">The value to be supplied to the <code>-ldflags</code> flag parameter.</td></tr><tr><td style="text-align:center;">extra_files</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">Specifies that additional files will be packaged within the article. Multiple files separated by space. Copying folders is supported because <code>cp -r</code> is executed internally. E.g., <code>extra_files: LICENSE README.md</code></td></tr><tr><td style="text-align:center;">md5sum</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">Publish <code>.md5</code> with the artifact, which defaults to TRUE.</td></tr><tr><td style="text-align:center;">sha256sum</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">Publish <code>.sha256</code> with the artifact, which defaults to FALSE.</td></tr><tr><td style="text-align:center;">release_tag</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">The target version label to which the binaries are published. It strives to publish the binaries to a specified publish page on every push, since there is no target in this case. If, like most people, the action is triggered via the <code>release:[created]</code> event, do not set it</td></tr><tr><td style="text-align:center;">release_name</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">Alternative <code>release_tag</code> is used to publish target specs and binary pushes. The latest version of a given <code>release_name</code> will be selected from all versions. Useful for example, unlabeled (draft).</td></tr><tr><td style="text-align:center;">overwrite</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">If the asset already exists, it is overwritten. The default is FALSE。</td></tr><tr><td style="text-align:center;">asset_name</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">If you don&#39;t want to use the default format, customize the asset name <code>\${BINARY_NAME}-\${RELEASE_TAG}-\${GOOS}-\${GOARCH}</code>. Make sure it is set correctly, especially for matrix usages that must be appended <code>-\${{ matrix.goos }}-\${{ matrix.goarch }}</code>. A valid example might be <code>asset_name: binary-name-\${{ matrix.goos }}-\${{ matrix.goarch }}</code>.</td></tr><tr><td style="text-align:center;">retry</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">If the upload fails, how many times to retry. The default is 3.</td></tr><tr><td style="text-align:center;">post_command</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;">Additional commands that will be executed for disassembly. For example, you can use it to upload artifacts to AWS S3 or Alibaba Cloud OSS</td></tr><tr><td style="text-align:center;">compress_assets</td><td style="text-align:center;"><strong>not</strong></td><td style="text-align:center;"><code>auto</code> will generate a <code>zip</code> file for Windows and <code>tar.gz</code> file for others by default. <code>zip</code> will force the use of <code>zip</code>. <code>OFF</code> will disable asset packing.</td></tr></tbody></table></div><h2 id="legacy-issues" tabindex="-1">Legacy issues <a class="header-anchor" href="#legacy-issues" aria-label="Permalink to &quot;Legacy issues&quot;">​</a></h2><p>If a single project is configured with both automatically generated release and the current build binary Action, it will be found that the build is not triggered after the release is released, and no better solution has been found to this problem.</p>`,17)])])}const k=t(n,[["render",l]]);export{g as __pageData,k as default};
